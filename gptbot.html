<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Polymarket GPT Bot Scanner v9.5</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Live Polymarket crypto market scanner">

<style>
body {
  margin: 0;
  background: #0b0f14;
  color: #e6edf3;
  font-family: Arial, sans-serif;
}

.version {
  position: fixed;
  top: 6px;
  left: 14px;
  font-size: 12px;
  opacity: 0.6;
}

header {
  text-align: center;
  padding: 18px;
  border-bottom: 1px solid #1f2933;
}

h1 {
  margin: 0;
  color: #4da3ff;
}

.controls {
  padding: 14px 16px;
  border-bottom: 1px solid #1f2933;
}

input[type=password] {
  padding: 6px;
  width: 280px;
}

button {
  padding: 8px 16px;
  font-weight: bold;
  border: none;
  cursor: pointer;
}

.start { background: #16a34a; color: #fff; }
.stop  { background: #dc2626; color: #fff; }

.status {
  margin-top: 8px;
  font-size: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 8px;
  border-bottom: 1px solid #1f2933;
}

th {
  color: #93c5fd;
}

a.market {
  color: #2dd4bf;
  text-decoration: underline;
}

.risk-safe { color: #22c55e; }
.risk-mid  { color: #eab308; }
.risk-high { color: #ef4444; }
</style>
</head>

<body>

<div class="version">v9 · build 9.5</div>

<header>
  <h1>Polymarket GPT Bot Scanner v9</h1>
  <div>Research-first scanner. AI added later.</div>
</header>

<div class="controls">
  <input id="apiKey" type="password"
    placeholder="OpenAI API key (unused for now)" />
  <button id="startBtn" class="start">START SCANNER</button>
  <button id="stopBtn" class="stop" style="display:none;">STOP SCANNER</button>

  <div class="status" id="status">Status: idle</div>
</div>

<table>
<thead>
<tr>
  <th>Market</th>
  <th>Side</th>
  <th>Prob</th>
  <th>Risk</th>
  <th>Time Left</th>
  <th>Status</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
const WORKER =
  "https://solitary-paper-639a.cryptoworldgames.workers.dev";

let running = false;

document.getElementById("startBtn").onclick = startScan;
document.getElementById("stopBtn").onclick = stopScan;

function stopScan() {
  running = false;
  document.getElementById("startBtn").style.display = "inline-block";
  document.getElementById("stopBtn").style.display = "none";
  document.getElementById("status").textContent = "Status: stopped";
}

function timeLeft(end) {
  if (!end) return "rolling";
  const ms = new Date(end) - new Date();
  if (ms <= 0) return "ended";
  const mins = Math.floor(ms / 60000);
  if (mins < 60) return `${mins}m`;
  const hrs = Math.floor(mins / 60);
  if (hrs < 48) return `${hrs}h`;
  const days = Math.floor(hrs / 24);
  return `${days}d`;
}

async function startScan() {
  running = true;
  document.getElementById("rows").innerHTML = "";
  document.getElementById("status").textContent = "Status: scanning...";
  document.getElementById("startBtn").style.display = "none";
  document.getElementById("stopBtn").style.display = "inline-block";

  let markets = [];
  try {
    const res = await fetch(
      `${WORKER}/?url=https://gamma-api.polymarket.com/markets`
    );
    markets = await res.json();
  } catch (e) {
    document.getElementById("status").textContent =
      "Status: failed to load markets";
    stopScan();
    return;
  }

  let shown = 0;

  for (const m of markets) {
    if (!running || shown >= 50) break;
    if (!m.active || m.closed) continue;
    if (!m.question) continue;

    // Crypto-only filter (simple + reliable)
    const q = m.question.toLowerCase();
    if (
      !q.includes("btc") &&
      !q.includes("bitcoin") &&
      !q.includes("eth") &&
      !q.includes("ethereum") &&
      !q.includes("sol") &&
      !q.includes("xrp")
    ) continue;

    let probText = "—";
    let risk = "UNKNOWN";
    let riskClass = "risk-mid";

    if (Array.isArray(m.outcomePrices) &&
        typeof m.outcomePrices[0] === "number") {
      const p = Math.round((1 - m.outcomePrices[0]) * 100);
      probText = `${p}%`;
      if (p >= 80) { risk = "SAFE"; riskClass = "risk-safe"; }
      else if (p >= 60) { risk = "MID"; riskClass = "risk-mid"; }
      else { risk = "RISK"; riskClass = "risk-high"; }
    }

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>
        <a class="market" target="_blank"
          href="https://polymarket.com/search?_q=${encodeURIComponent(m.question)}">
          ${m.question}
        </a>
      </td>
      <td>YES</td>
      <td>${probText}</td>
      <td class="${riskClass}">${risk}</td>
      <td>${timeLeft(m.endDate)}</td>
      <td>LIVE</td>
    `;

    document.getElementById("rows").appendChild(tr);
    shown++;
  }

  document.getElementById("status").textContent =
    `Status: loaded ${shown} crypto markets`;
}
</script>

</body>
</html>
