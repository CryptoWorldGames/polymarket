<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Polymarket GPT Bot Scanner v9</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Polymarket GPT Bot Scanner v9 build 9.3">
<meta name="theme-color" content="#0b0f14">

<style>
body {
  margin: 0;
  background: #0b0f14;
  color: #e6edf3;
  font-family: Arial, sans-serif;
}

.version {
  position: fixed;
  top: 8px;
  left: 20px;
  font-size: 12px;
  opacity: 0.6;
}

header {
  text-align: center;
  padding: 18px;
  border-bottom: 1px solid #1f2933;
}

h1 {
  margin: 0;
  color: #4da3ff;
}

.controls {
  padding: 16px;
  border-bottom: 1px solid #1f2933;
}

input[type=password] {
  padding: 6px;
  width: 300px;
}

button {
  padding: 10px 18px;
  font-weight: bold;
  border: none;
  cursor: pointer;
}

.start { background: #16a34a; color: #fff; }
.stop  { background: #dc2626; color: #fff; }

.filters {
  margin-top: 10px;
}

.filters label {
  margin-right: 12px;
}

.status {
  margin-top: 8px;
  font-size: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 8px;
  border-bottom: 1px solid #1f2933;
  text-align: left;
}

th {
  color: #93c5fd;
}

a.market {
  color: #2dd4bf;
}

.risk-safe { color: #22c55e; }
.risk-mid  { color: #eab308; }
.risk-high { color: #ef4444; }

.ai-note {
  opacity: 0.8;
  font-size: 13px;
}
</style>
</head>

<body>

<div class="version">v9 · build 9.3</div>

<header>
  <h1>Polymarket GPT Bot Scanner v9</h1>
  <div>Research-first scanner. AI must justify safety.</div>
</header>

<div class="controls">
  <input id="apiKey" type="password" placeholder="Paste OpenAI API key (hidden)" />
  <button id="startBtn" class="start">START SCANNER</button>
  <button id="stopBtn" class="stop" style="display:none;">STOP SCANNER</button>

  <div class="filters">
    <strong>Categories:</strong>
    <label><input type="checkbox" checked> Crypto</label>
    <label><input type="checkbox" checked> Politics</label>
    <label><input type="checkbox" checked> Sports</label>
    <label><input type="checkbox" checked> Tech</label>
    <label><input type="checkbox" checked> Culture</label>
    <label><input type="checkbox" checked> Business</label>
    <label><input type="checkbox" checked> World</label>
    <label><input type="checkbox" checked> Other</label>
  </div>

  <div class="filters">
    <strong>Probability Filter:</strong>
    <select id="probFilter">
      <option value="50" selected>50%+</option>
      <option value="60">60%+</option>
      <option value="70">70%+</option>
      <option value="80">80%+</option>
      <option value="90">90%+</option>
    </select>
  </div>

  <div id="status" class="status">Status: idle</div>
</div>

<table>
<thead>
<tr>
  <th>Select</th>
  <th>Market</th>
  <th>Side</th>
  <th>Prob</th>
  <th>Risk</th>
  <th>Time Left</th>
  <th>AI Comment</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
const WORKER = "https://solitary-paper-639a.cryptoworldgames.workers.dev";
let running = false;

document.getElementById("startBtn").onclick = startScan;
document.getElementById("stopBtn").onclick = stopScan;

function stopScan() {
  running = false;
  document.getElementById("status").textContent = "Status: stopped";
  document.getElementById("startBtn").style.display = "inline-block";
  document.getElementById("stopBtn").style.display = "none";
}

function timeLeft(end) {
  const ms = new Date(end) - new Date();
  if (ms <= 0) return "ended";
  const h = Math.floor(ms / 36e5);
  const d = Math.floor(h / 24);
  return d > 0 ? `${d}d ${h % 24}h` : `${h}h`;
}

async function startScan() {
  running = true;
  document.getElementById("rows").innerHTML = "";
  document.getElementById("status").textContent = "Status: scanning...";
  document.getElementById("startBtn").style.display = "none";
  document.getElementById("stopBtn").style.display = "inline-block";

  const res = await fetch(`${WORKER}/?url=https://gamma-api.polymarket.com/markets`);
  const markets = await res.json();

  const minProb = parseInt(document.getElementById("probFilter").value);
  let shown = 0;

  for (const m of markets) {
    if (!running) break;
    if (!m.active || m.closed || !m.endDate) continue;

    const remaining = new Date(m.endDate) - new Date();
    if (remaining > 14 * 86400000) continue;

    const priceYes = m.outcomePrices?.[0];
    if (typeof priceYes !== "number") continue;

    const prob = Math.round((1 - priceYes) * 100);
    if (prob < minProb) continue;

    const risk =
      prob >= 90 ? "SAFE" :
      prob >= 75 ? "MID" : "RISK";

    const riskClass =
      risk === "SAFE" ? "risk-safe" :
      risk === "MID" ? "risk-mid" : "risk-high";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input type="checkbox"></td>
      <td><a class="market" target="_blank"
        href="https://polymarket.com/search?_q=${encodeURIComponent(m.question)}">
        ${m.question}</a></td>
      <td>YES</td>
      <td>${prob}%</td>
      <td class="${riskClass}">${risk}</td>
      <td>${timeLeft(m.endDate)}</td>
      <td class="ai-note">AI review pending</td>
    `;
    document.getElementById("rows").appendChild(tr);
    shown++;
    document.getElementById("status").textContent =
      `Status: scanning… ${shown} found`;
  }

  document.getElementById("status").textContent =
    `Status: loaded ${shown} active markets`;
}
</script>

</body>
</html>
