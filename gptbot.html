<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Polymarket GPT Bot Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!--
File: gptbot.html
Version: v0005

Short commit message:
Add AI reasoning and sticky verdicts

Long commit message:
Adds explainable AI verdicts with a 250-character
"why" field, sticky SAFE/RISK states, category fixes
for Crypto-only filtering, serialized AI queue to
eliminate rate-limit spam, and tiered recheck timing
(60s SAFE, 3m RISK).
-->

<style>
body { background:#0d1117; color:#e6edf3; font-family:Arial; text-align:center; }
h1 { color:#58a6ff; }
input,select { background:#161b22; color:#e6edf3; border:1px solid #30363d; border-radius:6px; padding:8px; }
button { padding:10px 22px; border-radius:10px; border:none; font-weight:bold; cursor:pointer; }
.start { background:#238636; color:white; }
.stop { background:#da3633; color:white; }
.panel { max-width:1000px; margin:20px auto; background:#161b22; padding:15px; border-radius:12px; text-align:left; }
table { width:98%; margin:auto; border-collapse:collapse; }
th,td { padding:8px; border-bottom:1px solid #30363d; text-align:left; vertical-align:top; }
th { background:#1f6feb; }
.safe { color:#3fb950; font-weight:bold; }
.risk { color:#f85149; font-weight:bold; }
.wait { color:#d29922; }
small { color:#8b949e; }
footer { margin:40px; color:#6e7681; font-size:12px; }
</style>
</head>

<body>

<h1>Polymarket GPT Bot Scanner</h1>
<p>Research-first scanner. AI must justify safety.</p>

<input id="apiKey" type="password" placeholder="Paste OpenAI API key" style="width:260px">

<br><br>

<select id="threshold">
  <option value="0.90">90%+</option>
  <option value="0.95" selected>95%+</option>
  <option value="0.98">98%+</option>
</select>

<div class="panel">
<strong>Market Filters</strong><br><br>
<label><input type="checkbox" data-cat="crypto" checked> Crypto</label>
<label><input type="checkbox" data-cat="politics"> Politics</label>
<label><input type="checkbox" data-cat="tech"> Tech / AI</label>
<label><input type="checkbox" data-cat="geo"> Geopolitics</label>
<label><input type="checkbox" data-cat="culture"> Culture</label>
<label><input type="checkbox" data-cat="sports"> Sports</label>
<label><input type="checkbox" data-cat="other"> Other</label>
</div>

<button id="toggle" class="start">START SCANNER</button>

<div class="panel">
<div>Status: <span id="status">Stopped</span></div>
<div>AI Calls: <span id="calls">0</span></div>
<div>Queue: <span id="queue">Idle</span></div>
</div>

<table>
<thead>
<tr>
<th>Market</th>
<th>Side</th>
<th>Prob</th>
<th>Status</th>
<th>Why (AI)</th>
<th>Link</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<footer>gptbot.html v0005</footer>

<script>
const API="https://gamma-api.polymarket.com/markets?limit=500&active=true&closed=false";
const PROXY="https://api.allorigins.win/raw?url=";
const SAFE_RECHECK=60000;
const RISK_RECHECK=180000;
const AI_DELAY=5000;

let running=false, queue=[], processing=false, calls=0;
let state={};

function cat(q){
 q=q.toLowerCase();
 if(/bitcoin|btc|eth|ethereum|stablecoin|usdt|usdc/.test(q)) return "crypto";
 if(/election|president|congress/.test(q)) return "politics";
 if(/ai|openai|google|meta/.test(q)) return "tech";
 if(/war|nato|ukraine|china|russia/.test(q)) return "geo";
 if(/album|movie|celebrity/.test(q)) return "culture";
 if(/win|championship|season/.test(q)) return "sports";
 return "other";
}

async function fetchJSON(u){
 try{const r=await fetch(PROXY+encodeURIComponent(u));return r.json();}catch{return[];}
}

async function aiProcess(){
 if(processing||queue.length===0||!running) return;
 processing=true;
 document.getElementById("queue").textContent="Processing";
 const item=queue.shift();
 calls++; document.getElementById("calls").textContent=calls;

 try{
  const r=await fetch("https://api.openai.com/v1/chat/completions",{
   method:"POST",
   headers:{
    "Content-Type":"application/json",
    "Authorization":"Bearer "+document.getElementById("apiKey").value
   },
   body:JSON.stringify({
    model:"gpt-4",
    messages:[{role:"user",content:
`Determine if this Polymarket outcome is extremely unlikely to reverse.
Respond as:
SAFE or RISK
Reason: (≤250 chars, cite news, social signals, or lack of risk)

"${item.q}"`
    }]
   })
  });
  const d=await r.json();
  const t=d.choices[0].message.content;
  const safe=t.startsWith("SAFE");
  const reason=t.split("Reason:")[1]?.trim().slice(0,250)||"";

  state[item.id].status=safe?"safe":"risk";
  state[item.id].why=reason;
  item.row.cells[3].innerHTML=safe?'<span class="safe">✅ Safe</span>':'<span class="risk">⚠️ Risk</span>';
  item.row.cells[4].innerHTML="<small>"+reason+"</small>";

 }catch{}

 setTimeout(()=>{processing=false;document.getElementById("queue").textContent="Waiting";aiProcess();},AI_DELAY);
}

async function scan(){
 const data=await fetchJSON(API);
 const cats=[...document.querySelectorAll("input[data-cat]:checked")].map(c=>c.dataset.cat);
 const t=parseFloat(threshold.value);
 const body=document.getElementById("rows");

 data.forEach(m=>{
  if(state[m.id]) return;
  if(!cats.includes(cat(m.question))) return;
  let p=JSON.parse(m.outcomePrices||"[]");
  if(p[0]<t&&p[1]<t) return;

  const side=p[0]>=p[1]?"YES":"NO";
  const tr=document.createElement("tr");
  tr.innerHTML=`
   <td>${m.question}</td>
   <td>${side}</td>
   <td>${(Math.max(p[0],p[1])*100).toFixed(1)}%</td>
   <td class="wait">Researching…</td>
   <td></td>
   <td><a href="https://polymarket.com/event/${m.slug}" target="_blank">Open</a></td>`;
  body.appendChild(tr);

  state[m.id]={status:"pending",row:tr,why:""};
  queue.push({id:m.id,q:m.question,row:tr});
 });

 aiProcess();
}

toggle.onclick=()=>{
 if(!running){
  running=true;
  status.textContent="Running";
  toggle.textContent="STOP SCANNER";
  toggle.className="stop";
  scan();
  setInterval(scan,60000);
 }else{
  running=false;
  status.textContent="Stopped";
  toggle.textContent="START SCANNER";
  toggle.className="start";
 }
};

if(Notification.permission!=="granted") Notification.requestPermission();
</script>

</body>
</html>
